<div class="chat-container">
  <div class="chat-messages">
    <div class="grid gap-y-2">

      @for (message of messages(); track $index) {
        @if (!message.travelPlan) {
          <app-chat-message
            [message]="message.text"
            [isUserMessage]="message.senderType === SenderType.USER"
          />
        } @else {
          <ng-container [ngTemplateOutlet]="planTemplate" [ngTemplateOutletContext]="{message}"></ng-container>
        }
      }

      @if (isLoading()) {
        <app-typing-loader />
      }
    </div>
  </div>

  <!-- Message box -->
   <app-text-message-box
    placeholder="Type your message here..."
    (messageEmitter)="handleMessage($event)"
   />
</div>

<ng-template #planTemplate let-message="message">
  <div class="relative mr-3 text-sm bg-black/75 pt-3 pb-2 px-4 shadow rounded-xl">
    <h2>âœ… Your Travel Plan</h2>

    <section>
      <div><strong>ğŸï¸ Destination:</strong> {{ message?.travelPlan?.destination }}</div>
      <div><strong>ğŸ’µ Estimated Total:</strong> {{ message?.travelPlan?.estimatedTotal | currency }}</div>
      <div><strong>ğŸ’¡ Recommendation:</strong> {{ message?.travelPlan?.recommendation }}</div>
      <div><strong>ğŸŒ¤ï¸ Weather Forecast:</strong> {{ message?.travelPlan?.weatherForecast }}</div>
    </section>

    @if (message?.travelPlan?.flights?.length) {
      <section>
        <strong>âœˆï¸ Flights</strong>
        <ul>
          @for (flight of message?.travelPlan?.flights; track $index) {
            <li>{{ flight }}</li>
          }
        </ul>
      </section>
    }
    @if (message?.travelPlan?.hotels?.length) {
      <section>
        <strong>ğŸ¨ Hotels</strong>
        <ul>
          @for (hotel of message?.travelPlan?.hotels; track $index) {
            <li>{{ hotel }}</li>
          }
        </ul>
      </section>
    }
    @if (message?.travelPlan?.itinerary?.length) {
      <section>
        <strong>ğŸ§³ Suggested Itinerary</strong>
        <ul>
          @for (itinerary of message?.travelPlan?.itinerary; track $index) {
            <li>{{ itinerary }}</li>
          }
        </ul>
      </section>
    }
    @if (message?.travelPlan?.agentRationales) {
      <section>
        <strong>ğŸ¤– Agent Rationales</strong>
          <div>
          @for (key of objectKeys(message?.travelPlan?.agentRationales); track $index) {
            <li><em>{{ key }}:</em> {{ message?.travelPlan?.agentRationales[key] }}</li>
          }
        </div>
      </section>
    }
  </div>
</ng-template>
